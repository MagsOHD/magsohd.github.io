<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple ntfy.sh</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #000;
            border: 2px solid #00ff00;
            padding: 20px;
            border-radius: 10px;
        }
        h1 {
            color: #ff6600;
            text-align: center;
        }
        .test-btn {
            background: transparent;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            font-family: inherit;
            border-radius: 5px;
        }
        .test-btn:hover {
            background: #00ff00;
            color: #000;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
            background: #111;
        }
        .success { border-color: #00ff00; color: #00ff00; }
        .error { border-color: #ff0000; color: #ff0000; }
        .warning { border-color: #ff6600; color: #ff6600; }
        .topic-input {
            background: #111;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            width: 100%;
            margin: 10px 0;
            font-family: inherit;
        }
        .config-info {
            background: #111;
            border: 1px solid #666;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî Test Simple ntfy.sh</h1>

        <div class="config-info">
            <h3>üìã Configuration Actuelle</h3>
            <div id="config-display">Chargement...</div>
        </div>

        <div>
            <h3>üõ†Ô∏è Configuration Manuelle</h3>
            <input type="text" id="manual-topic" class="topic-input"
                   placeholder="Entrez votre topic ntfy.sh personnalis√©">
            <button class="test-btn" onclick="setManualTopic()">Utiliser ce topic</button>
        </div>

        <div>
            <h3>üß™ Tests Rapides</h3>
            <button class="test-btn" onclick="testBasic()">Test Basique</button>
            <button class="test-btn" onclick="testDirect()">Test Direct</button>
            <button class="test-btn" onclick="testWithCurl()">G√©n√©rer commande curl</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let currentTopic = null;

        // Charger la configuration
        function loadConfig() {
            const configDiv = document.getElementById('config-display');

            // Essayer de charger depuis diff√©rentes sources
            let topic = null;
            let source = 'Aucune';

            // Source 1: Meta tag
            const metaTag = document.querySelector('meta[name="ntfy-topic"]');
            if (metaTag && metaTag.content && metaTag.content !== 'YOUR_NTFY_TOPIC') {
                topic = metaTag.content;
                source = 'Meta tag HTML';
            }

            // Source 2: Variable globale (si disponible)
            if (!topic && window.NTFY_TOPIC && window.NTFY_TOPIC !== 'YOUR_NTFY_TOPIC') {
                topic = window.NTFY_TOPIC;
                source = 'Variable globale JS';
            }

            currentTopic = topic;

            configDiv.innerHTML = `
                <strong>Topic trouv√©:</strong> ${topic || 'Non configur√©'}<br>
                <strong>Source:</strong> ${source}<br>
                <strong>Statut:</strong> ${topic ? '‚úÖ Configur√©' : '‚ùå Non configur√©'}<br>
                <strong>Connexion:</strong> ${navigator.onLine ? '‚úÖ En ligne' : '‚ùå Hors ligne'}
            `;

            if (!topic) {
                addResult('‚ö†Ô∏è Aucun topic trouv√©. Utilisez la configuration manuelle.', 'warning');
            }
        }

        // D√©finir un topic manuellement
        function setManualTopic() {
            const input = document.getElementById('manual-topic');
            const topic = input.value.trim();

            if (!topic) {
                addResult('‚ùå Veuillez entrer un topic valide', 'error');
                return;
            }

            currentTopic = topic;
            addResult(`‚úÖ Topic d√©fini manuellement: ${topic}`, 'success');
            loadConfig();
        }

        // Test basique avec fetch
        async function testBasic() {
            if (!currentTopic) {
                addResult('‚ùå Aucun topic configur√©. D√©finissez-en un d\'abord.', 'error');
                return;
            }

            addResult('üîî Test basique en cours...', 'warning');

            try {
                const response = await fetch(`https://ntfy.sh/${currentTopic}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                        'Title': 'Test Portfolio',
                        'Priority': '3',
                        'Tags': 'test,portfolio'
                    },
                    body: `üß™ Test simple depuis le portfolio

Timestamp: ${new Date().toISOString()}
Topic: ${currentTopic}
Page: ${window.location.href}`
                });

                if (response.ok) {
                    addResult('‚úÖ Test basique r√©ussi! V√©rifiez votre app ntfy.', 'success');
                } else {
                    const errorText = await response.text();
                    addResult(`‚ùå Erreur HTTP ${response.status}: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå Erreur r√©seau: ${error.message}`, 'error');
            }
        }

        // Test direct avec ntfy.sh
        async function testDirect() {
            if (!currentTopic) {
                addResult('‚ùå Aucun topic configur√©', 'error');
                return;
            }

            addResult('üöÄ Test direct en cours...', 'warning');

            try {
                const response = await fetch(`https://ntfy.sh/${currentTopic}`, {
                    method: 'POST',
                    headers: {
                        'Title': 'Test Direct Portfolio',
                        'Priority': 'high',
                        'Tags': 'urgent,test,direct',
                        'Actions': 'view, Voir Portfolio, https://magsohd.github.io/currentFolio/'
                    },
                    body: 'üöÄ Test direct r√©ussi!\n\nCe message est envoy√© directement depuis votre portfolio.'
                });

                if (response.ok) {
                    addResult('‚úÖ Test direct r√©ussi! Notification envoy√©e avec actions.', 'success');
                } else {
                    addResult(`‚ùå Test direct √©chou√©: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå Erreur test direct: ${error.message}`, 'error');
            }
        }

        // G√©n√©rer commande curl pour test externe
        function testWithCurl() {
            if (!currentTopic) {
                addResult('‚ùå Aucun topic configur√©', 'error');
                return;
            }

            const curlCommand = `curl -d "Test depuis curl - Portfolio Lucas" \\
  -H "Title: Test curl Portfolio" \\
  -H "Priority: high" \\
  -H "Tags: test,curl,portfolio" \\
  ntfy.sh/${currentTopic}`;

            addResult(`üìã Commande curl g√©n√©r√©e:

<pre style="background: #222; padding: 10px; border-radius: 5px; overflow-x: auto;">
${curlCommand}
</pre>

Copiez cette commande et ex√©cutez-la dans votre terminal pour tester.`, 'success');
        }

        // Ajouter un r√©sultat
        function addResult(message, type) {
            const resultsDiv = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();

            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `[${timestamp}] ${message}`;

            resultsDiv.appendChild(resultDiv);
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialiser au chargement
        document.addEventListener('DOMContentLoaded', loadConfig);

        // Mise √† jour statut connexion
        window.addEventListener('online', () => {
            addResult('üåê Connexion internet r√©tablie', 'success');
            loadConfig();
        });

        window.addEventListener('offline', () => {
            addResult('‚ùå Connexion internet perdue', 'error');
            loadConfig();
        });
    </script>
</body>
</html>